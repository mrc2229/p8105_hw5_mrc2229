---
title: "p8105_hw5_mrc2229"
author: "Matthew Curran"
date: "November 7, 2019"
output: github_document
---

```{r}
library(tidyverse)
library(janitor)
library(rvest)
library(viridis)
library(broom)
```

## Problem 1 - Replace the missing values in the iris data set.

```{r}
set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))

replace_function = function(x) {
  if(is.numeric(x)) {
    replace_na(x, round(mean(x, na.rm = TRUE), digits=1))
  }
  else if(!is.numeric(x)){
    replace_na(x,"virginica")
  }
}

iris_new = map_df(iris_with_missing, ~replace_function(.x))
```

* The iris_is_missing data set has been updated with a function that relpaces missing enteries for numeric variables with the mean of non-missing values and missing character variables are filled in with "virginica". This new dataset is called iris_new.


## Problem 2 - Create a tidy dataframe from a longitudinal study that included a control arm and an experimental arm.

```{r}
data_function = function(y) {
  data = read.csv(y)
}

long_study_tib = tibble(
  file_name = list.files(path = "./data/"),
  path = str_c("./data/", file_name)
)

long_study = long_study_tib %>%
  mutate(lists = map(path, data_function)) %>%
  unnest(cols=lists)%>%
  mutate(
    subject_id=row_number()
  )%>%
  pivot_longer(
    week_1:week_8,
    names_to = "week",
    values_to = "value"
  ) %>%
  separate(file_name, into = c("study_arm", "id"), sep="_")%>%
  mutate(
    study_arm = recode(study_arm, con = "Control Group", exp = "Experimental Group")
  ) %>%
  select(-path,-id)%>%
  mutate(
    subject_id = str_replace(subject_id, ".csv",""),
    week = str_replace(week,"week_","")
  )

## Make a Spaghetti Plot showing Observations of each Subject over Time

long_study_plot = long_study %>%
  group_by(study_arm, subject_id, week)%>%
  ggplot(aes(x=week,y=value))+
  geom_path(aes(group=subject_id, color=study_arm))+
  scale_color_viridis(
    discrete = TRUE,
    name = "Study Arm"
  )+
  labs(
    title = "Observed Value of each Subject over an 8 Week Period",
    x = "Week Number",
    y ="Values"
  ) 

long_study_plot
```

* Looking at this Spaghetti Plot, it is apparent that the obsereved values of those in the experimental arm increase over the 8 weeks, while the values of those in the control arm remain roughly the same.

* In the begining of the study, the mean value of those in the control group was `r long_study %>% group_by(study_arm) %>% filter(study_arm=="Control Group") %>% filter(week=="1") %>% summarise(mean_con=round(mean(value), digits=2)) %>% pull(mean_con)` and in the experimental group it was`r long_study %>% group_by(study_arm) %>% filter(study_arm=="Experimental Group") %>% filter(week=="1") %>% summarise(mean_exp=round(mean(value), digits=2)) %>% pull(mean_exp)`

* At week 8, the mean value of those in the control group was `r long_study %>% group_by(study_arm) %>% filter(study_arm=="Control Group") %>% filter(week=="8") %>% summarise(mean_con_end=round(mean(value), digits=2)) %>% pull(mean_con_end)` and in the experimental group it was `r long_study %>% group_by(study_arm) %>% filter(study_arm=="Experimental Group") %>% filter(week=="8") %>% summarise(mean_exp_end=round(mean(value), digits=2)) %>% pull(mean_exp_end)`

## Problem 3: A Simulation to Explore Power in a Simple Linear Regression

```{r}
regression = function(
  n = 30, beta0 = 2, beta1 = 0, var =50
) {
  reg_data = tibble(
    x = rnorm(n),
    y = beta0 + beta1*x + rnorm (n, 0, 50^0.5)
  )
  
  reg_fit = lm(y~x, data = reg_data)
  
  tidy(reg_fit)
  }
```

